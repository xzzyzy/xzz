<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <!-- é˜²æ­¢å¾®ä¿¡å†…ç½®æµè§ˆå™¨å±è”½ -->
<meta name="referrer" content="never">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<!-- ç¦æ­¢å¾®ä¿¡è‡ªåŠ¨è¯†åˆ«ç”µè¯å·ç å’Œé‚®ç®± -->
<meta name="format-detection" content="telephone=no, email=no">

<!-- iOS Safari è§¦æ‘¸ä¼˜åŒ– -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é›‡ä½£ç«¥å·¥</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 15px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            margin-bottom: 10px;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        .main-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ff9966, #ff5e62);
            border: none;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 20px rgba(255,94,98,0.3);
            transition: all 0.1s;
            touch-action: manipulation;
        }

        .main-button:active {
            transform: scale(0.95);
            box-shadow: 0 5px 10px rgba(255,94,98,0.2);
        }

        .upgrades-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .upgrade-card {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upgrade-card:active {
            transform: scale(0.98);
        }

        .upgrade-card.unlocked {
            background: rgba(46, 204, 113, 0.2);
        }

        .upgrade-cost {
            color: #ffd700;
            font-weight: bold;
            font-size: 14px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            padding: 10px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .nav-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
            color: white;
            text-decoration: none;
            font-size: 12px;
        }

        .content {
            padding-bottom: 70px; /* ä¸ºåº•éƒ¨å¯¼èˆªç•™ç©ºé—´ */
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }

        .float-number {
            position: fixed;
            pointer-events: none;
            font-weight: bold;
            font-size: 20px;
            color: #ffd700;
            animation: floatUp 1s forwards;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 400px) {
            .main-button {
                width: 120px;
                height: 120px;
                font-size: 18px;
            }

            .upgrades-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’° ç‚¹ç‚¹æ³°è²</h1>
            <p>ç‚¹ä¸€ç‚¹ï¼ŒæŒ‚ä¸€æŒ‚ï¼Œé€ æ³°è² </p>
        </div>

        <div class="stats-bar">
            <div class="stat-card">
                <div>ğŸ’° é‡‘å¸</div>
                <div id="gold" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div>âš¡ ç‚¹å‡»æ”¶ç›Š</div>
                <div id="clickValue" class="stat-value">1</div>
            </div>
            <div class="stat-card">
                <div>ğŸš€ æ¯ç§’æ”¶ç›Š</div>
                <div id="perSecond" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div>ğŸŒŸ æ€»æ”¶ç›Š</div>
                <div id="totalEarned" class="stat-value">0</div>
            </div>
        </div>

        <div class="content">
            <div id="tab-mine" class="tab-content active">
                <button id="mineBtn" class="main-button">
                    ğŸ’<br>ç‚¹å‡»æŒ–çŸ¿ï¼
                </button>
                <div style="text-align: center; margin-top: 10px;">
                    <p>é•¿æŒ‰å¯è¿ç»­ç‚¹å‡»</p>
                </div>
            </div>

            <div id="tab-upgrade" class="tab-content">
                <h3 style="text-align: center; margin: 15px 0;">ğŸ”§ å‡çº§å•†åº—</h3>
                <div id="upgradesList" class="upgrades-container">
                    <!-- å‡çº§é¡¹åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div id="tab-manager" class="tab-content">
                <h3 style="text-align: center; margin: 15px 0;">ğŸ‘¨â€ğŸ’¼ ç»ç†ç®¡ç†</h3>
                <div id="managersList" class="upgrades-container">
                    <!-- ç»ç†é¡¹åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <a href="#" class="nav-btn" onclick="showTab('mine')">ğŸ  æŒ–çŸ¿</a>
            <a href="#" class="nav-btn" onclick="showTab('upgrade')">ğŸ›’ å‡çº§</a>
            <a href="#" class="nav-btn" onclick="showTab('manager')">ğŸ‘¥ ç»ç†</a>
            <a href="#" class="nav-btn" onclick="saveGame()">ğŸ’¾ ä¿å­˜</a>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        let game = {
            gold: 0,
            clickPower: 1,
            perSecond: 0,
            totalEarned: 0,
            upgrades: [],
            managers: [],
            lastUpdate: Date.now()
        };

        // å‡çº§é…ç½®
        const upgradeConfig = [
            { id: 1, name: "é“é•", icon: "â›ï¸", cost: 10, power: 1, owned: 0 },
            { id: 2, name: "é“œé•", icon: "ğŸ› ï¸", cost: 50, power: 2, owned: 0 },
            { id: 3, name: "é“¶é•", icon: "âš’ï¸", cost: 200, power: 5, owned: 0 },
            { id: 4, name: "é‡‘é•", icon: "ğŸ”¨", cost: 1000, power: 10, owned: 0 },
            { id: 5, name: "é’»çŸ³é•", icon: "ğŸ’", cost: 5000, power: 20, owned: 0 },
            { id: 6, name: "å°çŸ¿å·¥", icon: "ğŸ‘·", cost: 100, income: 1, owned: 0 },
            { id: 7, name: "å·¥ç¨‹å¸ˆ", icon: "ğŸ‘¨â€ğŸ”§", cost: 500, income: 5, owned: 0 },
            { id: 8, name: "çŸ¿åœºç»ç†", icon: "ğŸ‘¨â€ğŸ’¼", cost: 2000, income: 20, owned: 0 }
        ];

        // ç»ç†é…ç½®
        const managerConfig = [
            { id: 1, name: "åˆçº§æ³°è²", icon: "ğŸ‘¨â€ğŸ’¼", cost: 1000, effect: "è‡ªåŠ¨ç‚¹å‡»1æ¬¡/ç§’", owned: false },
            { id: 2, name: "é«˜çº§æ³°è²", icon: "ğŸ‘¨â€ğŸ”¬", cost: 5000, effect: "è‡ªåŠ¨ç‚¹å‡»5æ¬¡/ç§’", owned: false },
            { id: 3, name: "æ€»ç›‘æ³°è²", icon: "ğŸ‘¨â€ğŸ’»", cost: 20000, effect: "è‡ªåŠ¨ç‚¹å‡»20æ¬¡/ç§’", owned: false }
        ];

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadGame();
            renderUpgrades();
            renderManagers();
            updateDisplay();
            startGameLoop();

            // ç¦»çº¿æ”¶ç›Š
            const offlineTime = Date.now() - game.lastUpdate;
            if (offlineTime > 1000) { // è‡³å°‘ç¦»çº¿1ç§’
                const offlineSeconds = Math.floor(offlineTime / 1000);
                const offlineGold = offlineSeconds * game.perSecond;
                if (offlineGold > 0) {
                    game.gold += offlineGold;
                    game.totalEarned += offlineGold;
                    showFloatText(`ç¦»çº¿æ”¶ç›Š: +${formatNumber(offlineGold)}`, 3000);
                }
            }
        }

        // æŒ–çŸ¿ç‚¹å‡»
        document.getElementById('mineBtn').addEventListener('click', mine);

        // é•¿æŒ‰è¿ç»­ç‚¹å‡»
        let holdTimer;
        document.getElementById('mineBtn').addEventListener('touchstart', function(e) {
            e.preventDefault();
            holdTimer = setInterval(mine, 100); // æ¯100msç‚¹å‡»ä¸€æ¬¡
        });

        document.getElementById('mineBtn').addEventListener('touchend', function(e) {
            e.preventDefault();
            clearInterval(holdTimer);
        });

        // é˜²æ­¢é•¿æŒ‰å‡ºç°èœå•
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        function mine() {
            game.gold += game.clickPower;
            game.totalEarned += game.clickPower;

            // ç‚¹å‡»æ•ˆæœ
            const btn = document.getElementById('mineBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);

            // æ˜¾ç¤ºæ¼‚æµ®æ•°å­—
            showFloatText(`+${game.clickPower}`, 1000, btn.getBoundingClientRect());

            updateDisplay();
        }

        // æ˜¾ç¤ºæ¼‚æµ®æ•°å­—
        function showFloatText(text, duration, rect) {
            const floatNum = document.createElement('div');
            floatNum.className = 'float-number';
            floatNum.textContent = text;

            if (rect) {
                floatNum.style.left = (rect.left + rect.width / 2) + 'px';
                floatNum.style.top = (rect.top) + 'px';
            } else {
                floatNum.style.left = '50%';
                floatNum.style.top = '50%';
            }

            document.body.appendChild(floatNum);

            setTimeout(() => floatNum.remove(), duration);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, duration = 3000) {
            const msg = document.createElement('div');
            msg.textContent = text;
            msg.style.cssText = `
                position: fixed;
                top: 20%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                z-index: 1000;
                animation: fadeInOut ${duration}ms;
            `;

            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), duration);

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('msgAnim')) {
                const style = document.createElement('style');
                style.id = 'msgAnim';
                style.textContent = `
                    @keyframes fadeInOut {
                        0%, 100% { opacity: 0; transform: translate(-50%, -20px); }
                        20%, 80% { opacity: 1; transform: translate(-50%, 0); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // æ¸²æŸ“å‡çº§é¡¹
        function renderUpgrades() {
            const container = document.getElementById('upgradesList');
            container.innerHTML = '';

            upgradeConfig.forEach(upgrade => {
                const card = document.createElement('div');
                card.className = `upgrade-card ${upgrade.owned > 0 ? 'unlocked' : ''}`;
                card.onclick = () => buyUpgrade(upgrade.id);

                const canAfford = game.gold >= upgrade.cost;
                card.style.opacity = canAfford ? '1' : '0.6';

                card.innerHTML = `
                    <div style="font-size: 24px;">${upgrade.icon}</div>
                    <div style="font-size: 12px; margin: 5px 0;">${upgrade.name}</div>
                    ${upgrade.power ?
                        `<div style="font-size: 11px; color: #4cd964;">+${upgrade.power} ç‚¹å‡»åŠ›</div>` :
                        `<div style="font-size: 11px; color: #5ac8fa;">+${upgrade.income}/ç§’</div>`}
                    <div style="font-size: 11px; margin: 3px 0;">æ‹¥æœ‰: ${upgrade.owned}</div>
                    <div class="upgrade-cost">ğŸ’° ${formatNumber(upgrade.cost)}</div>
                `;

                container.appendChild(card);
            });
        }

        // æ¸²æŸ“ç»ç†
        function renderManagers() {
            const container = document.getElementById('managersList');
            container.innerHTML = '';

            managerConfig.forEach(manager => {
                const card = document.createElement('div');
                card.className = `upgrade-card ${manager.owned ? 'unlocked' : ''}`;
                card.onclick = () => buyManager(manager.id);

                const canAfford = game.gold >= manager.cost;
                card.style.opacity = canAfford ? '1' : '0.6';

                card.innerHTML = `
                    <div style="font-size: 24px;">${manager.icon}</div>
                    <div style="font-size: 12px; margin: 5px 0;">${manager.name}</div>
                    <div style="font-size: 11px; color: #ffcc00; margin: 3px 0;">${manager.effect}</div>
                    <div style="font-size: 11px; margin: 3px 0;">${manager.owned ? 'âœ… å·²é›‡ä½£' : 'å¯é›‡ä½£'}</div>
                    <div class="upgrade-cost">ğŸ’° ${formatNumber(manager.cost)}</div>
                `;

                container.appendChild(card);
            });
        }

        // è´­ä¹°å‡çº§
        function buyUpgrade(id) {
            const upgrade = upgradeConfig.find(u => u.id === id);
            if (!upgrade) return;

            if (game.gold >= upgrade.cost) {
                game.gold -= upgrade.cost;
                upgrade.owned++;

                if (upgrade.power) {
                    game.clickPower += upgrade.power;
                }
                if (upgrade.income) {
                    game.perSecond += upgrade.income;
                }

                // ä»·æ ¼é€’å¢
                upgrade.cost = Math.floor(upgrade.cost * 1.5);

                updateDisplay();
                renderUpgrades();
                showMessage(`è´­ä¹°æˆåŠŸï¼${upgrade.name} +1`);
            } else {
                showMessage('é‡‘å¸ä¸è¶³ï¼');
            }
        }

        // é›‡ä½£ç»ç†
        function buyManager(id) {
            const manager = managerConfig.find(m => m.id === id);
            if (!manager || manager.owned) return;

            if (game.gold >= manager.cost) {
                game.gold -= manager.cost;
                manager.owned = true;

                // ç»ç†æ•ˆæœ
                switch(id) {
                    case 1: // åˆçº§æ³°è²
                        setInterval(() => mine(), 1000);
                        break;
                    case 2: // é«˜çº§æ³°è²
                        setInterval(() => mine(), 200);
                        break;
                    case 3: // æ€»ç›‘æ³°è²
                        setInterval(() => { mine(); mine(); }, 100);
                        break;
                }

                updateDisplay();
                renderManagers();
                showMessage(`é›‡ä½£æˆåŠŸï¼${manager.name} å·²ä¸Šä»»`);
            } else {
                showMessage('é‡‘å¸ä¸è¶³ï¼');
            }
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function startGameLoop() {
            setInterval(() => {
                // è‡ªåŠ¨æ”¶ç›Š
                if (game.perSecond > 0) {
                    const income = game.perSecond;
                    game.gold += income;
                    game.totalEarned += income;
                    updateDisplay();
                }
            }, 1000);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('gold').textContent = formatNumber(game.gold);
            document.getElementById('clickValue').textContent = formatNumber(game.clickPower);
            document.getElementById('perSecond').textContent = formatNumber(game.perSecond);
            document.getElementById('totalEarned').textContent = formatNumber(game.totalEarned);
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(`tab-${tabName}`).classList.add('active');

            return false; // é˜»æ­¢é“¾æ¥è·³è½¬
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            const saveData = {
                gold: game.gold,
                clickPower: game.clickPower,
                perSecond: game.perSecond,
                totalEarned: game.totalEarned,
                upgrades: upgradeConfig.map(u => ({ id: u.id, owned: u.owned, cost: u.cost })),
                managers: managerConfig.map(m => ({ id: m.id, owned: m.owned })),
                lastUpdate: Date.now()
            };

            localStorage.setItem('idleMinerSave', JSON.stringify(saveData));
            showMessage('æ¸¸æˆå·²ä¿å­˜ï¼');
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const save = localStorage.getItem('idleMinerSave');
            if (save) {
                const saveData = JSON.parse(save);

                game.gold = saveData.gold || 0;
                game.clickPower = saveData.clickPower || 1;
                game.perSecond = saveData.perSecond || 0;
                game.totalEarned = saveData.totalEarned || 0;
                game.lastUpdate = saveData.lastUpdate || Date.now();

                // åŠ è½½å‡çº§
                if (saveData.upgrades) {
                    saveData.upgrades.forEach(savedUpgrade => {
                        const upgrade = upgradeConfig.find(u => u.id === savedUpgrade.id);
                        if (upgrade) {
                            upgrade.owned = savedUpgrade.owned || 0;
                            upgrade.cost = savedUpgrade.cost || upgrade.cost;
                        }
                    });
                }

                // åŠ è½½ç»ç†
                if (saveData.managers) {
                    saveData.managers.forEach(savedManager => {
                        const manager = managerConfig.find(m => m.id === savedManager.id);
                        if (manager) {
                            manager.owned = savedManager.owned || false;
                        }
                    });
                }

                showMessage('æ¸¸æˆå·²åŠ è½½ï¼');
            }
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
            if (num >= 10000) return (num / 1000).toFixed(1) + 'K';
            if (num >= 1000) return (num / 1000).toFixed(2) + 'K';
            return Math.floor(num);
        }

        // é¡µé¢å…³é—­å‰ä¿å­˜
        window.addEventListener('beforeunload', saveGame);

        // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
        setInterval(saveGame, 30000);

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>